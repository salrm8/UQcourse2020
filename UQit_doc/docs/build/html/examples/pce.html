

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>generalized Polynomial Chaos Expansion (gPCE) &mdash; UQit 1.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> UQit
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/instl_dep.html">Installation and Dependencies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/codes_list.html">List of core codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/terminology.html">Overview &amp; Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/sampling.html">Sampling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/surrogate.html">Surrogates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/uqFWD.html">UQ Forward Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/gsa.html">Global Sensitivity Analysis (GSA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../UQit_core_/others.html">Other Core Codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bib.html">Bibliography</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">UQit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>generalized Polynomial Chaos Expansion (gPCE)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/examples/pce.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="generalized-Polynomial-Chaos-Expansion-(gPCE)">
<h1>generalized Polynomial Chaos Expansion (gPCE)<a class="headerlink" href="#generalized-Polynomial-Chaos-Expansion-(gPCE)" title="Permalink to this headline">¶</a></h1>
<p>Saleh Rezaeiravesh, <a class="reference external" href="mailto:salehr&#37;&#52;&#48;kth&#46;se">salehr<span>&#64;</span>kth<span>&#46;</span>se</a> SimEx/FLOW, Engineering Mechanics, KTH Royal Institute of Technology, Stockholm, Sweden</p>
<p>The aim of this notebook is to show how to use <code class="docutils literal notranslate"><span class="pre">UQit</span></code> for non-intrusive gPCE. In practice, we have the parameter samples and associated values of the model response. Therefore, we only want to construct the PCE and estimate statistical moments of the model function due to the variability of the uncertain parameters. This basically means much of the coding in the following examples is not required. Here, the extensive examples are provided to validate the implementation of the gPCE in <code class="docutils literal notranslate"><span class="pre">UQit</span></code>
for different combinations of parameters as well as different parameter dimensions. The validation is achieved through comparing the moments estimated by PCE with the reference values obtained either from analytical expressions or standard Monte-Carlo method.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">mt</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">UQit.pce</span> <span class="kn">import</span> <span class="n">pce</span><span class="p">,</span> <span class="n">pceEval</span><span class="p">,</span> <span class="n">convPlot</span>
<span class="kn">import</span> <span class="nn">UQit.analyticTestFuncs</span> <span class="k">as</span> <span class="nn">analyticTestFuncs</span>
<span class="kn">import</span> <span class="nn">UQit.write</span> <span class="k">as</span> <span class="nn">writeUQ</span>
<span class="kn">import</span> <span class="nn">UQit.reshaper</span> <span class="k">as</span> <span class="nn">reshaper</span>
<span class="kn">import</span> <span class="nn">UQit.sampling</span> <span class="k">as</span> <span class="nn">sampling</span>
</pre></div>
</div>
</div>
<div class="section" id="Example-1:-gPCE-for-one-parameter-with-uniform-distribution">
<h2>Example 1: gPCE for one parameter with uniform distribution<a class="headerlink" href="#Example-1:-gPCE-for-one-parameter-with-uniform-distribution" title="Permalink to this headline">¶</a></h2>
<p>Consider a model function <span class="math notranslate nohighlight">\(f(q)\)</span>, where <span class="math notranslate nohighlight">\(q\sim\mathcal{U}[a,b]\)</span>. The aim is to apply gPCE to estimate <span class="math notranslate nohighlight">\(\mathbb{E}_q[f(q)]\)</span> and <span class="math notranslate nohighlight">\(\mathbb{V}_q[f(q)]\)</span> and also construct a surrogate <span class="math notranslate nohighlight">\(\tilde{f}(q)\)</span>.</p>
<p>In particular, we consider</p>
<div class="math notranslate nohighlight">
\[\begin{equation}
r=10+0.7\sin(5q)+3 \cos(q)
\end{equation}\]</div>
<p>which is implemented in <code class="docutils literal notranslate"><span class="pre">analyticTestFuncs.fEx1D(qNodes,'type1')</span></code>. The exact values of the mean and variance of this test function can be computed analytically and be used to validate the PCE estimations.</p>
<p><strong>Step 1:</strong> Set the general settings</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">distType</span><span class="o">=</span><span class="s1">&#39;Unif&#39;</span>   <span class="c1">#distribution type of the parameter</span>
<span class="n">qInfo</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">4.0</span><span class="p">]</span>    <span class="c1">#parameter&#39;s admissible range</span>
<span class="n">n</span><span class="o">=</span><span class="mi">10</span>              <span class="c1">#number of training samples</span>
<span class="n">nTest</span><span class="o">=</span><span class="mi">200</span>         <span class="c1">#number of test samples in the parameter space</span>
</pre></div>
</div>
</div>
<p>Set the PCE settings; we assume the training samples to be in the form of Gauss-Legendre nodes. The PCE coefficients are to be obtained by the <code class="docutils literal notranslate"><span class="pre">Projection</span></code> method. Alternatively one can choose the <code class="docutils literal notranslate"><span class="pre">Regression</span></code> method.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sampleType</span><span class="o">=</span><span class="s1">&#39;GQ&#39;</span>    <span class="c1">#&#39;GQ&#39;=Gauss Quadrature nodes</span>
                   <span class="c1">#&#39;&#39;= any other sample =&gt; only &#39;Regression&#39; can be selected</span>
<span class="n">pceSolveMethod</span><span class="o">=</span><span class="s1">&#39;Projection&#39;</span> <span class="c1">#&#39;Regression&#39;: for any combination of sample points</span>
                            <span class="c1">#&#39;Projection&#39;: only for GQ</span>
</pre></div>
</div>
</div>
<p><strong>Step 2:</strong> Put together the PCE information in <code class="docutils literal notranslate"><span class="pre">pceDict</span></code>. If some of the options are wrongly set by the user, <code class="docutils literal notranslate"><span class="pre">pceDict_corrector</span></code> will correct it.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pceDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;sampleType&#39;</span><span class="p">:</span><span class="n">sampleType</span><span class="p">,</span><span class="s1">&#39;pceSolveMethod&#39;</span><span class="p">:</span><span class="n">pceSolveMethod</span><span class="p">,</span><span class="s1">&#39;distType&#39;</span><span class="p">:[</span><span class="n">distType</span><span class="p">]}</span>
</pre></div>
</div>
</div>
<p><strong>Step 3:</strong> Generate training samples. We choose the samples to be Gauss-Legendre nodes. Note that samples <span class="math notranslate nohighlight">\(\{q^{(i)}\}_{i=1}^n \in \mathbb{Q}\)</span> where <span class="math notranslate nohighlight">\(\mathbb{Q}\)</span> is <code class="docutils literal notranslate"><span class="pre">qInfo</span></code>, the admissible range of the parameter. Based on the gPCE rule, the polynomial bases are Legendre polynomials defined over the mapped space <span class="math notranslate nohighlight">\(\Gamma=[-1,1]\)</span>. Therefore corresponding to each <span class="math notranslate nohighlight">\(q^{(i)}\)</span>, there is a unique <span class="math notranslate nohighlight">\(\xi^{(i)}\in\Gamma\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">samps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">trainSample</span><span class="p">(</span><span class="n">sampleType</span><span class="o">=</span><span class="n">sampleType</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">,</span><span class="n">nSamp</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">q</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">q</span>       <span class="c1">#training samples in the original parameter space</span>
<span class="n">xi</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">xi</span>     <span class="c1">#training samples in the mapped parameter space</span>
<span class="n">qBound</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">qBound</span>  <span class="c1">#admissible range of the parameter</span>
</pre></div>
</div>
</div>
<p><strong>Step 4:</strong> Run the simulators at the training samples.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fEx</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx1D</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="s1">&#39;type1&#39;</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">f</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">val</span>
</pre></div>
</div>
</div>
<p><strong>Step 5</strong> Construct the PCE, given the training data.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pce_</span><span class="o">=</span><span class="n">pce</span><span class="p">(</span><span class="n">fVal</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xi</span><span class="p">[:,</span><span class="kc">None</span><span class="p">],</span><span class="n">pceDict</span><span class="o">=</span><span class="n">pceDict</span><span class="p">)</span>
<span class="n">fMean</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fMean</span>     <span class="c1">#E[f(q)] estimated by PCE</span>
<span class="n">fVar</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fVar</span>       <span class="c1">#V[f(q)] estimated by PCE</span>
<span class="n">pceCoefs</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">coefs</span>  <span class="c1">#Coefficients of the PCE</span>
</pre></div>
</div>
</div>
<p>The outputs are the coefficients in the PCE along with the estimated <span class="math notranslate nohighlight">\(\mathbb{E}_q[f(q)]\)</span> and <span class="math notranslate nohighlight">\(\mathbb{V}_q[f(q)]\)</span>.</p>
<p>Compute the exact moments of f(q), as the reference values</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fEx</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">fMean_ex</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">mean</span>
<span class="n">fVar_ex</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">var</span>
</pre></div>
</div>
</div>
<p><strong>Step 6:</strong> Validate the PCE_estimated moments with associated analytical values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;--------- Exact --------- PCE ---- Error % &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E[(q)] = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fMean_ex</span><span class="p">,</span><span class="n">fMean</span><span class="p">,(</span><span class="n">fMean</span><span class="o">-</span><span class="n">fMean_ex</span><span class="p">)</span><span class="o">/</span><span class="n">fMean_ex</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;V[f(q)] = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fVar_ex</span><span class="p">,</span><span class="n">fVar</span><span class="p">,(</span><span class="n">fVar</span><span class="o">-</span><span class="n">fVar_ex</span><span class="p">)</span><span class="o">/</span><span class="n">fVar_ex</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------- Exact --------- PCE ---- Error %
E[(q)] = 10.0471        10.056  0.0882092
V[f(q)] = 4.91876       5.05353 2.73999
</pre></div></div>
</div>
<p>Plot the convergence of the PCE terms:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">convPlot</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_23_0.png" src="../_images/examples_pce_23_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;UQit.pce.convPlot at 0x7f3c5d727a50&gt;
</pre></div></div>
</div>
<p><strong>Step 7:</strong> Visually compare the PCE surrogate with the actual simulator at a set of test samples taken from the considered parameter range. First, we generate test points and the value of the simulator.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">testSamps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">testSample</span><span class="p">(</span><span class="s1">&#39;unifSpaced&#39;</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">,</span><span class="n">qBound</span><span class="o">=</span><span class="n">qBound</span><span class="p">,</span><span class="n">nSamp</span><span class="o">=</span><span class="n">nTest</span><span class="p">)</span>
<span class="n">qTest</span><span class="o">=</span><span class="n">testSamps</span><span class="o">.</span><span class="n">q</span>
<span class="n">xiTest</span><span class="o">=</span><span class="n">testSamps</span><span class="o">.</span><span class="n">xi</span>
<span class="n">fTest</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx1D</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="s1">&#39;type1&#39;</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span><span class="o">.</span><span class="n">val</span>   <span class="c1">#exact response at test samples</span>
</pre></div>
</div>
</div>
<p>Evaluate the constructed PCE at the test points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pcePred_</span><span class="o">=</span><span class="n">pceEval</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="p">[</span><span class="n">xiTest</span><span class="p">],</span><span class="n">distType</span><span class="o">=</span><span class="p">[</span><span class="n">distType</span><span class="p">])</span>
<span class="n">fPCE</span><span class="o">=</span><span class="n">pcePred_</span><span class="o">.</span><span class="n">pceVal</span>
</pre></div>
</div>
</div>
<p>Plot the PCE and exact values:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot1d</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fPCE</span><span class="p">,</span><span class="n">fMean</span><span class="p">,</span><span class="n">fVar</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="p">,</span><span class="s1">&#39;-k&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Exact $f(q)$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="s1">&#39;ob&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">sampleType</span><span class="o">+</span><span class="s1">&#39; Training Samples&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fPCE</span><span class="p">,</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;PCE&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fMean</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qTest</span><span class="p">)),</span><span class="s1">&#39;-b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbb</span><span class="si">{E}</span><span class="s1">(f(q))$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fMean</span><span class="o">+</span><span class="mf">1.96</span><span class="o">*</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fVar</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qTest</span><span class="p">)),</span><span class="n">fMean</span><span class="o">-</span><span class="mf">1.96</span><span class="o">*</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fVar</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qTest</span><span class="p">)),</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;powderblue&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fMean</span><span class="o">+</span><span class="mf">1.96</span><span class="o">*</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fVar</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qTest</span><span class="p">)),</span><span class="s1">&#39;--b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mathbb</span><span class="si">{E}</span><span class="s1">(f(q))\pm 95\%CI$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fMean</span><span class="o">-</span><span class="mf">1.96</span><span class="o">*</span><span class="n">mt</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">fVar</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">qTest</span><span class="p">)),</span><span class="s1">&#39;--b&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Example of 1D PCE for random variable of type </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span><span class="k">distType</span>)
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">19</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$f(q)$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">19</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>

<span class="n">plot1d</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fPCE</span><span class="p">,</span><span class="n">fMean</span><span class="p">,</span><span class="n">fVar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_29_0.png" src="../_images/examples_pce_29_0.png" />
</div>
</div>
</div>
<div class="section" id="Example-2:-gPCE-for-a-parameter-with-uniform-distribution">
<h2>Example 2: gPCE for a parameter with uniform distribution<a class="headerlink" href="#Example-2:-gPCE-for-a-parameter-with-uniform-distribution" title="Permalink to this headline">¶</a></h2>
<p>Repeat Example 1, with the parameter samples being chosen not as Gauss-Legendre nodes. Also use the total-order truncation scheme. For these settings, the regression method is used to compute the PCE coefficients. The distribution type and admissible range of the parameter are the same as the previous example.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n</span><span class="o">=</span><span class="mi">30</span>              <span class="c1">#number of training samples</span>
<span class="c1">#PCE Settings</span>
<span class="n">sampleType</span><span class="o">=</span><span class="s1">&#39;unifRand&#39;</span>
<span class="n">pceSolveMethod</span><span class="o">=</span><span class="s1">&#39;Regression&#39;</span>
<span class="n">LMax</span><span class="o">=</span><span class="mi">40</span>           <span class="c1">#maximum polynomial order in the total-order truncation</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#(0) Make the pceDict</span>
<span class="n">pceDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;sampleType&#39;</span><span class="p">:</span><span class="n">sampleType</span><span class="p">,</span><span class="s1">&#39;pceSolveMethod&#39;</span><span class="p">:</span><span class="n">pceSolveMethod</span><span class="p">,</span><span class="s1">&#39;LMax&#39;</span><span class="p">:</span><span class="n">LMax</span><span class="p">,</span>
         <span class="s1">&#39;distType&#39;</span><span class="p">:[</span><span class="n">distType</span><span class="p">]}</span>
<span class="c1">#(1) Generate training data</span>
<span class="n">samps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">trainSample</span><span class="p">(</span><span class="n">sampleType</span><span class="o">=</span><span class="n">sampleType</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">,</span><span class="n">nSamp</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">q</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">q</span>
<span class="n">xi</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">xi</span>
<span class="n">qBound</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">qBound</span>
<span class="n">fEx</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx1D</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="s1">&#39;type1&#39;</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">f</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">val</span>
<span class="c1">#(2) Construct the PCE</span>
<span class="n">pce_</span><span class="o">=</span><span class="n">pce</span><span class="p">(</span><span class="n">fVal</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xi</span><span class="p">[:,</span><span class="kc">None</span><span class="p">],</span><span class="n">pceDict</span><span class="o">=</span><span class="n">pceDict</span><span class="p">)</span>
<span class="n">fMean</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fMean</span>     <span class="c1">#E[f(q)] estimated by PCE</span>
<span class="n">fVar</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fVar</span>       <span class="c1">#V[f(q)] estimated by PCE</span>
<span class="n">pceCoefs</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">coefs</span>  <span class="c1">#Coefficients in the PCE</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
...... Number of terms in PCE, K=  40
...... Number of Data point, n=  30
-----------------------------------------------------------------
           OSQP v0.6.0  -  Operator Splitting QP Solver
              (c) Bartolomeo Stellato,  Goran Banjac
        University of Oxford  -  Stanford University 2019
-----------------------------------------------------------------
problem:  variables n = 80, constraints m = 120
          nnz(P) + nnz(A) = 1760
settings: linear system solver = qdldl,
          eps_abs = 1.0e-05, eps_rel = 1.0e-05,
          eps_prim_inf = 1.0e-04, eps_dual_inf = 1.0e-04,
          rho = 1.00e-01 (adaptive),
          sigma = 1.00e-06, alpha = 1.60, max_iter = 100000
          check_termination: on (interval 25),
          scaling: on, scaled_termination: off
          warm start: on, polish: on, time_limit: off

iter   objective    pri res    dua res    rho        time
   1  -3.2000e+02   3.02e+02   1.11e+05   1.00e-01   2.50e-04s
 200   2.7594e+01   2.14e-02   6.23e-04   1.94e-02   1.74e-03s
 400   2.7568e+01   2.15e-03   1.18e-04   1.94e-02   3.14e-03s
 600   2.7566e+01   3.51e-03   2.27e-05   1.94e-02   4.25e-03s
 650   2.7567e+01   2.01e-03   8.00e-06   1.94e-02   4.55e-03s

status:               solved
solution polish:      unsuccessful
number of iterations: 650
optimal objective:    27.5670
run time:             4.73e-03s
optimal rho estimate: 4.14e-02

...... Compressed sensing (regularization) is done.
       Min objective value=||fHat||= 27.567 in L1-sense.
</pre></div></div>
</div>
<p>Note that if the chosen <code class="docutils literal notranslate"><span class="pre">LMax</span></code> is larger than <code class="docutils literal notranslate"><span class="pre">n</span></code>, then the compressed sensing method is called which may happen that does not converge.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#(3) Compare moments: exact vs. PCE estimations</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------- Exact -------- PCE --------- Error % &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean of f(q) = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fMean_ex</span><span class="p">,</span><span class="n">fMean</span><span class="p">,(</span><span class="n">fMean</span><span class="o">-</span><span class="n">fMean_ex</span><span class="p">)</span><span class="o">/</span><span class="n">fMean_ex</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Var  of f(q) = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fVar_ex</span><span class="p">,</span><span class="n">fVar</span><span class="p">,(</span><span class="n">fVar</span><span class="o">-</span><span class="n">fVar_ex</span><span class="p">)</span><span class="o">/</span><span class="n">fVar_ex</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-------------- Exact -------- PCE --------- Error %
Mean of f(q) = 10.0471  9.18627 -8.5684
Var  of f(q) = 4.91876  5.26902 7.12092
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#(4) Plot the convergence of the PCE terms:</span>
<span class="n">convPlot</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_35_0.png" src="../_images/examples_pce_35_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;UQit.pce.convPlot at 0x7f3c5c3b71d0&gt;
</pre></div></div>
</div>
<p>Plot the response surface</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot1d</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fPCE</span><span class="p">,</span><span class="n">fMean</span><span class="p">,</span><span class="n">fVar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_37_0.png" src="../_images/examples_pce_37_0.png" />
</div>
</div>
<p>You can compare the accuracy of the estimated moments of <span class="math notranslate nohighlight">\(f(q)\)</span> and the constructed surrogate to what we got in Example 1.</p>
<p><strong>Extra:</strong> 1. Try to change the number of trainging samples and look at the convergence of the estimated moments and also above the deviation between the exact response and surrogate (above figure). 2. Change <code class="docutils literal notranslate"><span class="pre">LMax</span></code> and see how it impacts the outputs. 3. Try different types of training samples <code class="docutils literal notranslate"><span class="pre">unifSpaced</span></code>, <code class="docutils literal notranslate"><span class="pre">GLL</span></code>, <code class="docutils literal notranslate"><span class="pre">unifRand</span></code>, … .</p>
</div>
<div class="section" id="Example-3:-gPCE-for-a-parameter-with-Gaussian-distribution">
<h2>Example 3: gPCE for a parameter with Gaussian distribution<a class="headerlink" href="#Example-3:-gPCE-for-a-parameter-with-Gaussian-distribution" title="Permalink to this headline">¶</a></h2>
<p>Consider <span class="math notranslate nohighlight">\(q\sim\mathcal{N}(m,v^2)\)</span>, where <span class="math notranslate nohighlight">\(m\)</span> and <span class="math notranslate nohighlight">\(v\)</span> are known and constant. We want to use gPCE method to estimate the mean and variance of the following model function,</p>
<div class="math notranslate nohighlight">
\[f(q)=\cos(m(q-m))\,,\]</div>
<p>which is available in <code class="docutils literal notranslate"><span class="pre">UQit</span></code> as <code class="docutils literal notranslate"><span class="pre">analyticTestFuncs.fEx1D(q,'type2')</span></code>. The exact values of the mean and variance of this test function have been implemented in <code class="docutils literal notranslate"><span class="pre">UQit</span></code> and can be used to validate the PCE estimations.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Settings</span>
<span class="n">distType</span><span class="o">=</span><span class="s1">&#39;Norm&#39;</span>      <span class="c1">#distribution type of the parameter</span>
<span class="n">qInfo</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.9</span><span class="p">]</span>       <span class="c1">#[m,v] for &#39;Norm&#39; q~N(m,v^2)</span>
<span class="c1">#PCE settings</span>
<span class="n">n</span><span class="o">=</span><span class="mi">15</span>                 <span class="c1">#number of training samples</span>
<span class="n">nTest</span><span class="o">=</span><span class="mi">200</span>            <span class="c1">#number of test sample sin the parameter space</span>
<span class="n">sampleType</span><span class="o">=</span><span class="s1">&#39;GQ&#39;</span>      <span class="c1">#&#39;GQ&#39;=Gauss Quadrature nodes</span>
                     <span class="c1">#&#39;normRand&#39;= Random samples from the given Gaussian distribution</span>
                     <span class="c1"># see `trainSample` class in sampling.py</span>
<span class="n">pceSolveMethod</span><span class="o">=</span><span class="s1">&#39;Projection&#39;</span> <span class="c1">#&#39;Regression&#39;: for any combination of sample points</span>
                            <span class="c1">#&#39;Projection&#39;: only for GQ</span>
<span class="n">LMax_</span><span class="o">=</span><span class="mi">50</span>            <span class="c1">#(Only used Regresson method)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#(0) Make the pceDict</span>
<span class="n">pceDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;sampleType&#39;</span><span class="p">:</span><span class="n">sampleType</span><span class="p">,</span><span class="s1">&#39;pceSolveMethod&#39;</span><span class="p">:</span><span class="n">pceSolveMethod</span><span class="p">,</span><span class="s1">&#39;LMax&#39;</span><span class="p">:</span><span class="n">LMax_</span><span class="p">,</span>
        <span class="s1">&#39;distType&#39;</span><span class="p">:[</span><span class="n">distType</span><span class="p">]}</span>
<span class="c1">#(1) Generate training data</span>
<span class="n">samps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">trainSample</span><span class="p">(</span><span class="n">sampleType</span><span class="o">=</span><span class="n">sampleType</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">,</span><span class="n">nSamp</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">q</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">q</span>
<span class="n">xi</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">xi</span>
<span class="n">qBound</span><span class="o">=</span><span class="n">samps</span><span class="o">.</span><span class="n">qBound</span>
<span class="n">fEx</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx1D</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="s1">&#39;type2&#39;</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">f</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">val</span>
<span class="c1">#(2) Compute the exact moments (as the reference data)</span>
<span class="n">fEx</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">fMean_ex</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">mean</span>
<span class="n">fVar_ex</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">var</span>
<span class="c1">#(3) Construct the PCE</span>
<span class="n">pce_</span><span class="o">=</span><span class="n">pce</span><span class="p">(</span><span class="n">fVal</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xi</span><span class="p">[:,</span><span class="kc">None</span><span class="p">],</span><span class="n">pceDict</span><span class="o">=</span><span class="n">pceDict</span><span class="p">)</span>
<span class="n">fMean</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fMean</span>     <span class="c1">#E[f(q)] estimated by PCE</span>
<span class="n">fVar</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fVar</span>       <span class="c1">#V[f(q)] estimated by PCE</span>
<span class="n">pceCoefs</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">coefs</span>  <span class="c1">#Coefficients in the PCE</span>
</pre></div>
</div>
</div>
<p>Compare moments: exact vs. PCE estimations</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------- Exact ----- PCE --------- Error % &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean of f(q) = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fMean_ex</span><span class="p">,</span><span class="n">fMean</span><span class="p">,(</span><span class="n">fMean</span><span class="o">-</span><span class="n">fMean_ex</span><span class="p">)</span><span class="o">/</span><span class="n">fMean_ex</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Var  of f(q) = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fVar_ex</span><span class="p">,</span><span class="n">fVar</span><span class="p">,(</span><span class="n">fVar</span><span class="o">-</span><span class="n">fVar_ex</span><span class="p">)</span><span class="o">/</span><span class="n">fVar_ex</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
----------------- Exact ----- PCE --------- Error %
Mean of f(q) = 0.197899 0.197899        5.15003e-11
Var  of f(q) = 0.461603 0.461608        0.00111709
</pre></div></div>
</div>
<p>Convergence of the PCE terms</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">convPlot</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_45_0.png" src="../_images/examples_pce_45_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;UQit.pce.convPlot at 0x7f3c5c5fc0d0&gt;
</pre></div></div>
</div>
<p>Evaluate the PCE at test samples and plot the response surface</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">testSamps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">testSample</span><span class="p">(</span><span class="s1">&#39;unifSpaced&#39;</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">,</span><span class="n">qBound</span><span class="o">=</span><span class="n">qBound</span><span class="p">,</span><span class="n">nSamp</span><span class="o">=</span><span class="n">nTest</span><span class="p">)</span>
<span class="n">qTest</span><span class="o">=</span><span class="n">testSamps</span><span class="o">.</span><span class="n">q</span>
<span class="n">xiTest</span><span class="o">=</span><span class="n">testSamps</span><span class="o">.</span><span class="n">xi</span>
<span class="n">fTest</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx1D</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="s1">&#39;type2&#39;</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span><span class="o">.</span><span class="n">val</span>   <span class="c1">#exact response at test samples</span>
<span class="c1">#Prediction by PCE at test samples</span>
<span class="n">pcePred_</span><span class="o">=</span><span class="n">pceEval</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="p">[</span><span class="n">xiTest</span><span class="p">],</span><span class="n">distType</span><span class="o">=</span><span class="p">[</span><span class="n">distType</span><span class="p">])</span>
<span class="n">fPCE</span><span class="o">=</span><span class="n">pcePred_</span><span class="o">.</span><span class="n">pceVal</span>
<span class="c1">#plot</span>
<span class="n">plot1d</span><span class="p">(</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">fPCE</span><span class="p">,</span><span class="n">fMean</span><span class="p">,</span><span class="n">fVar</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_47_0.png" src="../_images/examples_pce_47_0.png" />
</div>
</div>
<p>Note that despite the descrepancy between the PCE and exact response surface, the mean and variance of the model function can be estimated accurately by the PCE.</p>
</div>
<div class="section" id="Example-4:-gPCE-for-2-parameters-with-different-distributions">
<h2>Example 4: gPCE for 2 parameters with different distributions<a class="headerlink" href="#Example-4:-gPCE-for-2-parameters-with-different-distributions" title="Permalink to this headline">¶</a></h2>
<p>Let <span class="math notranslate nohighlight">\(q_1\)</span> and <span class="math notranslate nohighlight">\(q_2\)</span> be two independent uncertain parameters with known distributions. Also, consider a model function <span class="math notranslate nohighlight">\(f(q_1,q_2)\)</span> as the simulator. In <code class="docutils literal notranslate"><span class="pre">analyticTestFuncs.fEx2D(q1,q2,typ,method)</span></code> for <code class="docutils literal notranslate"><span class="pre">typ</span></code> equal to <code class="docutils literal notranslate"><span class="pre">'type1'</span></code>, <code class="docutils literal notranslate"><span class="pre">'type2'</span></code>, <code class="docutils literal notranslate"><span class="pre">'type3'</span></code>, and <code class="docutils literal notranslate"><span class="pre">'Rosenbrock'</span></code>, we have different functional form implemented for <span class="math notranslate nohighlight">\(f(q_1,q_2)\)</span>. We use <code class="docutils literal notranslate"><span class="pre">UQit</span></code> to construct a gPCE over the tensor-product space <span class="math notranslate nohighlight">\(\mathbb{Q}_1\bigotimes \mathbb{Q}_2\)</span>. The mean and variance
of <span class="math notranslate nohighlight">\(f(q_1,q_2)\)</span> estimated by gPCE are compared to the values directly estimated by pure Monte-Carlo method.</p>
<p>First, we set the specifications of the parameters and the options for PCE. It is recalled that if a parameter is uniformly distributed, then <code class="docutils literal notranslate"><span class="pre">qInfo</span></code> specifies the admissible range <span class="math notranslate nohighlight">\(\mathbb{Q}\)</span> of that parameter. But, if a parameter is Gaussian, then <code class="docutils literal notranslate"><span class="pre">qInfo=[m,v]</span></code> corresponds to <span class="math notranslate nohighlight">\(\mathcal{N}(m,v^2)\)</span>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Parameters specifications</span>
<span class="n">distType</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Unif&#39;</span><span class="p">,</span><span class="s1">&#39;Norm&#39;</span><span class="p">]</span>   <span class="c1">#distribution type of the parameters q1, q2</span>
<span class="n">qInfo</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>             <span class="c1">#info on parameters</span>
       <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">0.4</span><span class="p">]]</span>
<span class="n">nQ</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">]</span>                   <span class="c1">#number of training samples of parameters</span>
<span class="n">nTest</span><span class="o">=</span><span class="p">[</span><span class="mi">121</span><span class="p">,</span><span class="mi">120</span><span class="p">]</span>            <span class="c1">#number of test points in parameter spaces to evaluate PCE</span>
<span class="c1">#PCE Options</span>
<span class="n">truncMethod</span><span class="o">=</span><span class="s1">&#39;TO&#39;</span>     <span class="c1">#&#39;TP&#39;=Tensor Product</span>
                     <span class="c1">#&#39;TO&#39;=Total Order</span>
<span class="n">sampleType</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GQ&#39;</span><span class="p">,</span><span class="s1">&#39;GQ&#39;</span><span class="p">]</span>  <span class="c1">#&#39;GQ&#39;=Gauss Quadrature nodes (&#39;Projection&#39; or &#39;Regression&#39;)</span>
                        <span class="c1">#For other type of samples, see sampling.py, trainSample =&gt; only &#39;Regression&#39; can be used</span>
                        <span class="c1">#&#39;LHS&#39;: Latin Hypercube Sampling (only when all distType=&#39;Unif&#39;)</span>
<span class="n">fType</span><span class="o">=</span><span class="s1">&#39;type1&#39;</span><span class="c1">#Type of the exact model response, &#39;type1&#39;, &#39;type2&#39;, &#39;type3&#39;, &#39;Rosenbrock&#39;</span>
<span class="n">pceSolveMethod</span><span class="o">=</span><span class="s1">&#39;Regression&#39;</span> <span class="c1">#&#39;Regression&#39;: for any combination of sampling and truncation methods</span>
                            <span class="c1">#&#39;Projection&#39;: only for &#39;GQ&#39;+&#39;TP&#39;</span>
<span class="k">if</span> <span class="n">truncMethod</span><span class="o">==</span><span class="s1">&#39;TO&#39;</span><span class="p">:</span>
   <span class="n">LMax</span><span class="o">=</span><span class="mi">9</span>   <span class="c1">#max polynomial order in each parameter dimention</span>
</pre></div>
</div>
</div>
<p>Assemble the pce dictionary:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">distType</span><span class="p">)</span>
<span class="n">pceDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">p</span><span class="p">,</span><span class="s1">&#39;truncMethod&#39;</span><span class="p">:</span><span class="n">truncMethod</span><span class="p">,</span><span class="s1">&#39;sampleType&#39;</span><span class="p">:</span><span class="n">sampleType</span><span class="p">,</span>
            <span class="s1">&#39;pceSolveMethod&#39;</span><span class="p">:</span><span class="n">pceSolveMethod</span><span class="p">,</span><span class="s1">&#39;distType&#39;</span><span class="p">:</span><span class="n">distType</span><span class="p">}</span>
<span class="k">if</span> <span class="n">truncMethod</span><span class="o">==</span><span class="s1">&#39;TO&#39;</span><span class="p">:</span>
   <span class="n">pceDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;LMax&#39;</span><span class="p">:</span><span class="n">LMax</span><span class="p">,</span><span class="s1">&#39;pceSolveMethod&#39;</span><span class="p">:</span><span class="s1">&#39;Regression&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>Generate the training data</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span><span class="o">=</span><span class="p">[]</span>
<span class="n">xi</span><span class="o">=</span><span class="p">[]</span>
<span class="n">qBound</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">samps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">trainSample</span><span class="p">(</span><span class="n">sampleType</span><span class="o">=</span><span class="n">sampleType</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                   <span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nSamp</span><span class="o">=</span><span class="n">nQ</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samps</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
    <span class="n">xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samps</span><span class="o">.</span><span class="n">xi</span><span class="p">)</span>
    <span class="n">qBound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samps</span><span class="o">.</span><span class="n">qBound</span><span class="p">)</span>
<span class="n">fEx_</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx2D</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fType</span><span class="p">,</span><span class="s1">&#39;tensorProd&#39;</span><span class="p">)</span>
<span class="n">fVal</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">val</span>
<span class="n">xiGrid</span><span class="o">=</span><span class="n">reshaper</span><span class="o">.</span><span class="n">vecs2grid</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Construct the PCE</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pce_</span><span class="o">=</span><span class="n">pce</span><span class="p">(</span><span class="n">fVal</span><span class="o">=</span><span class="n">fVal</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xiGrid</span><span class="p">,</span><span class="n">pceDict</span><span class="o">=</span><span class="n">pceDict</span><span class="p">,</span><span class="n">nQList</span><span class="o">=</span><span class="n">nQ</span><span class="p">)</span>
<span class="n">fMean</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fMean</span>
<span class="n">fVar</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fVar</span>
<span class="n">pceCoefs</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">coefs</span>
<span class="n">kSet</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">kSet</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... A gPCE for a 2-D parameter space is constructed.
...... PCE truncation method: TO
...... Method of computing PCE coefficients: Regression
         with LMax=9 as the max polynomial order in each direction.
...... Number of terms in PCE, K=  55
...... Number of Data point, n=  90
-----------------------------------------------------------------
           OSQP v0.6.0  -  Operator Splitting QP Solver
              (c) Bartolomeo Stellato,  Goran Banjac
        University of Oxford  -  Stanford University 2019
-----------------------------------------------------------------
problem:  variables n = 110, constraints m = 165
          nnz(P) + nnz(A) = 3217
settings: linear system solver = qdldl,
          eps_abs = 1.0e-05, eps_rel = 1.0e-05,
          eps_prim_inf = 1.0e-04, eps_dual_inf = 1.0e-04,
          rho = 1.00e-01 (adaptive),
          sigma = 1.00e-06, alpha = 1.60, max_iter = 100000
          check_termination: on (interval 25),
          scaling: on, scaled_termination: off
          warm start: on, polish: on, time_limit: off

iter   objective    pri res    dua res    rho        time
   1  -4.4000e+02   1.12e+05   4.59e+07   1.00e-01   9.13e-04s
 125   1.6933e+01   6.11e-01   8.24e-07   1.00e-01   2.67e-03s

status:               solved
solution polish:      unsuccessful
number of iterations: 125
optimal objective:    16.9331
run time:             3.12e-03s
optimal rho estimate: 6.28e+00

...... Compressed sensing (regularization) is done.
       Min objective value=||fHat||= 16.9331 in L1-sense.
</pre></div></div>
</div>
<p>Plot the convergence indicator of the PCE</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">convPlot</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">kSet</span><span class="o">=</span><span class="n">kSet</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_59_0.png" src="../_images/examples_pce_59_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;UQit.pce.convPlot at 0x7f3c5c0ad550&gt;
</pre></div></div>
</div>
<p>Use MC method to directly estimate reference values for the mean and varaiance of <span class="math notranslate nohighlight">\(f(\mathbf{q})\)</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fEx_</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">fMean_mc</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">mean</span>
<span class="n">fVar_mc</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">var</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... Reference moments are calculated by the Monte-Carlo method with 100000 samples
</pre></div></div>
</div>
<p>Generate test samples for the parameters and evaluate the exact response surface and the constructed PCE at them</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">testSamps2d</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">,</span><span class="n">qBound</span><span class="p">,</span><span class="n">nTest</span><span class="p">):</span>
    <span class="n">qTest</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">xiTest</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="n">testSamps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">testSample</span><span class="p">(</span><span class="s1">&#39;unifSpaced&#39;</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                    <span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">qBound</span><span class="o">=</span><span class="n">qBound</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nSamp</span><span class="o">=</span><span class="n">nTest</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">qTest_</span><span class="o">=</span><span class="n">testSamps</span><span class="o">.</span><span class="n">q</span>
        <span class="n">xiTest_</span><span class="o">=</span><span class="n">testSamps</span><span class="o">.</span><span class="n">xi</span>
        <span class="n">qTest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qTest_</span><span class="p">)</span>
        <span class="n">xiTest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xiTest_</span><span class="p">)</span>
    <span class="n">fTest</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx2D</span><span class="p">(</span><span class="n">qTest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qTest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fType</span><span class="p">,</span><span class="s1">&#39;tensorProd&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">val</span>
    <span class="k">return</span> <span class="n">xiTest</span><span class="p">,</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span>
<span class="n">xiTest</span><span class="p">,</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="o">=</span><span class="n">testSamps2d</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">,</span><span class="n">qBound</span><span class="p">,</span><span class="n">nTest</span><span class="p">)</span>
<span class="c1">#Evaluate PCE at the test samples</span>
<span class="n">pcePred_</span><span class="o">=</span><span class="n">pceEval</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xiTest</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">kSet</span><span class="o">=</span><span class="n">kSet</span><span class="p">)</span>
<span class="n">fPCE</span><span class="o">=</span><span class="n">pcePred_</span><span class="o">.</span><span class="n">pceVal</span>
</pre></div>
</div>
</div>
<p>Compare the PCE estimates for the moments of f(q) with the reference values obtained from the Monte-Carlo method</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------ MC -------- PCE --------- Error % &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean of f(q) = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fMean_mc</span><span class="p">,</span><span class="n">fMean</span><span class="p">,(</span><span class="n">fMean</span><span class="o">-</span><span class="n">fMean_mc</span><span class="p">)</span><span class="o">/</span><span class="n">fMean_mc</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Var  of f(q) = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fVar_mc</span><span class="p">,</span><span class="n">fVar</span><span class="p">,(</span><span class="n">fVar</span><span class="o">-</span><span class="n">fVar_mc</span><span class="p">)</span><span class="o">/</span><span class="n">fVar_mc</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
------------ MC -------- PCE --------- Error %
Mean of f(q) = -0.506728        -0.504892       -0.362226
Var  of f(q) = 3.70734  3.54174 -4.46686
</pre></div></div>
</div>
<p>Clearly, we see how the use of the gPCE with much fewer number of samples compared to Monte-Carlo approach, will result in the accurate estimates for the <span class="math notranslate nohighlight">\(\mathbb{E}[f(q_1,q_2)]\)</span> and <span class="math notranslate nohighlight">\(\mathbb{V}[f(q_1,q_2)]\)</span>.</p>
<p>Make contour plots of the response surfaces</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">plot2d</span><span class="p">(</span><span class="n">nTest</span><span class="p">,</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">fPCE</span><span class="p">):</span>
    <span class="c1"># Create 2D grid from the test samples and plot the contours of response surface over it</span>
    <span class="n">fTestGrid</span><span class="o">=</span><span class="n">fTest</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nTest</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
    <span class="n">fErrorGrid</span><span class="o">=</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">fTestGrid</span><span class="o">-</span><span class="n">fPCE</span><span class="p">))</span>
    <span class="c1"># 2D grid from the sampled parameters</span>
    <span class="k">if</span> <span class="n">sampleType</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;LHS&#39;</span> <span class="ow">and</span> <span class="n">sampleType</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;LHS&#39;</span><span class="p">:</span>
       <span class="n">qGrid</span><span class="o">=</span><span class="n">reshaper</span><span class="o">.</span><span class="n">vecsGlue</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
       <span class="n">qGrid</span><span class="o">=</span><span class="n">reshaper</span><span class="o">.</span><span class="n">vecs2grid</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span><span class="mi">8</span><span class="p">));</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">CS1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">qTest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qTest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fTestGrid</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS1</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">rightside_up</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">manual</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qGrid</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">qGrid</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_1$&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_2$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Exact Response&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">CS2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">qTest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qTest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fPCE</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS2</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">rightside_up</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">manual</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qGrid</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">qGrid</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_1$&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_2$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PCE Response&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">CS3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">qTest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qTest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fErrorGrid</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">CS3</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%0.2f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">rightside_up</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">manual</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_1$&#39;</span><span class="p">);</span><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$q_2$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qGrid</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">qGrid</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;|Exact-Surrogate|&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot2d</span><span class="p">(</span><span class="n">nTest</span><span class="p">,</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">fPCE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_68_0.png" src="../_images/examples_pce_68_0.png" />
</div>
</div>
<p>Now, let’s assume both parameters are uniformly distributed and use Latin-Hypercube Sampling (LHS). In this case, the number of samples becomes equal to <code class="docutils literal notranslate"><span class="pre">nQ[0]*nQ[1]</span></code>. The purpose of this example is to show we can use random parameter samples and large number of terms in the PCE. We need to do the following modifications in the settings:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">distType</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Unif&#39;</span><span class="p">,</span><span class="s1">&#39;Unif&#39;</span><span class="p">]</span>     <span class="c1">#distribution type of the parameters q1, q2</span>
<span class="n">sampleType</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LHS&#39;</span><span class="p">,</span><span class="s1">&#39;LHS&#39;</span><span class="p">]</span>
<span class="n">qInfo</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span>               <span class="c1">#info on parameters</span>
       <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span>
<span class="n">nQ</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span><span class="p">]</span>                   <span class="c1">#number of training samples of parameters</span>
<span class="k">if</span> <span class="n">truncMethod</span><span class="o">==</span><span class="s1">&#39;TO&#39;</span><span class="p">:</span>
   <span class="n">LMax</span><span class="o">=</span><span class="mi">35</span>   <span class="c1">#max polynomial order in each parameter dimention</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">pceDict</span></code> is updated due to the new inputs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">distType</span><span class="p">)</span>
<span class="n">pceDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">p</span><span class="p">,</span><span class="s1">&#39;truncMethod&#39;</span><span class="p">:</span><span class="n">truncMethod</span><span class="p">,</span><span class="s1">&#39;sampleType&#39;</span><span class="p">:</span><span class="n">sampleType</span><span class="p">,</span>
            <span class="s1">&#39;pceSolveMethod&#39;</span><span class="p">:</span><span class="n">pceSolveMethod</span><span class="p">,</span><span class="s1">&#39;distType&#39;</span><span class="p">:</span><span class="n">distType</span><span class="p">}</span>
<span class="k">if</span> <span class="n">truncMethod</span><span class="o">==</span><span class="s1">&#39;TO&#39;</span><span class="p">:</span>
   <span class="n">pceDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;LMax&#39;</span><span class="p">:</span><span class="n">LMax</span><span class="p">,</span><span class="s1">&#39;pceSolveMethod&#39;</span><span class="p">:</span><span class="s1">&#39;Regression&#39;</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p>We can generate the training samples as:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span><span class="o">=</span><span class="p">[]</span>
<span class="n">qBound</span><span class="o">=</span><span class="n">qInfo</span>
<span class="n">xi</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">LHS_sampling</span><span class="p">(</span><span class="n">nQ</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">nQ</span><span class="p">[</span><span class="mi">1</span><span class="p">],[[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span><span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pce</span><span class="o">.</span><span class="n">mapFromUnit</span><span class="p">(</span><span class="n">xi</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span><span class="n">qBound</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
<span class="n">fEx_</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx2D</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fType</span><span class="p">,</span><span class="s1">&#39;comp&#39;</span><span class="p">)</span>
<span class="n">fVal</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">val</span>
<span class="n">xiGrid</span><span class="o">=</span><span class="n">xi</span>
</pre></div>
</div>
</div>
<p>The PCE is constructed exactly as above:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">pce_</span><span class="o">=</span><span class="n">pce</span><span class="p">(</span><span class="n">fVal</span><span class="o">=</span><span class="n">fVal</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xiGrid</span><span class="p">,</span><span class="n">pceDict</span><span class="o">=</span><span class="n">pceDict</span><span class="p">,</span><span class="n">nQList</span><span class="o">=</span><span class="n">nQ</span><span class="p">)</span>
<span class="n">fMean</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fMean</span>
<span class="n">fVar</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fVar</span>
<span class="n">pceCoefs</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">coefs</span>
<span class="n">kSet</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">kSet</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... A gPCE for a 2-D parameter space is constructed.
...... PCE truncation method: TO
...... Method of computing PCE coefficients: Regression
         with LMax=35 as the max polynomial order in each direction.
...... Number of terms in PCE, K=  666
...... Number of Data point, n=  440
-----------------------------------------------------------------
           OSQP v0.6.0  -  Operator Splitting QP Solver
              (c) Bartolomeo Stellato,  Goran Banjac
        University of Oxford  -  Stanford University 2019
-----------------------------------------------------------------
problem:  variables n = 1332, constraints m = 1998
          nnz(P) + nnz(A) = 446216
settings: linear system solver = qdldl,
          eps_abs = 1.0e-05, eps_rel = 1.0e-05,
          eps_prim_inf = 1.0e-04, eps_dual_inf = 1.0e-04,
          rho = 1.00e-01 (adaptive),
          sigma = 1.00e-06, alpha = 1.60, max_iter = 100000
          check_termination: on (interval 25),
          scaling: on, scaled_termination: off
          warm start: on, polish: on, time_limit: off

iter   objective    pri res    dua res    rho        time
   1  -5.3280e+03   1.60e+02   3.46e+04   1.00e-01   2.16e-01s
 200   8.9177e+01   1.82e-02   1.32e-03   1.00e-01   4.91e-01s
 400   8.9594e+01   7.55e-03   7.08e-04   1.00e-01   7.39e-01s
 600   8.9842e+01   5.55e-03   3.55e-04   1.00e-01   9.90e-01s
 800   8.9907e+01   4.31e-03   3.55e-04   1.00e-01   1.24e+00s
1000   8.9945e+01   3.02e-03   2.03e-04   1.00e-01   1.50e+00s
1200   8.9983e+01   2.96e-03   1.28e-04   1.00e-01   1.77e+00s
1400   9.0036e+01   2.46e-03   2.27e-04   1.00e-01   2.16e+00s
1600   9.0070e+01   2.18e-03   1.02e-04   1.00e-01   2.55e+00s
1800   9.0087e+01   1.61e-03   1.08e-04   1.00e-01   2.91e+00s
2000   9.0100e+01   1.64e-03   1.13e-04   1.00e-01   3.28e+00s
2200   9.0121e+01   1.29e-03   1.98e-04   1.00e-01   3.53e+00s
2400   9.0132e+01   1.40e-03   8.46e-05   1.00e-01   3.79e+00s
2600   9.0139e+01   1.17e-03   6.73e-05   1.00e-01   4.16e+00s
2800   9.0144e+01   9.80e-04   6.22e-05   1.00e-01   4.57e+00s
3000   9.0149e+01   1.04e-03   5.92e-05   1.00e-01   4.86e+00s
3200   9.0154e+01   1.02e-03   4.03e-05   1.00e-01   5.18e+00s
3400   9.0163e+01   9.11e-04   4.14e-05   1.00e-01   5.50e+00s
3600   9.0167e+01   8.03e-04   6.28e-05   1.00e-01   5.89e+00s
3800   9.0178e+01   7.23e-04   7.20e-05   1.00e-01   6.24e+00s
4000   9.0184e+01   6.26e-04   4.54e-05   1.00e-01   6.67e+00s
4200   9.0189e+01   7.65e-04   5.77e-05   1.00e-01   7.06e+00s
4400   9.0189e+01   7.01e-04   6.10e-05   1.00e-01   7.42e+00s
4600   9.0193e+01   5.97e-04   5.59e-05   1.00e-01   7.67e+00s
4800   9.0195e+01   6.46e-04   6.38e-05   1.00e-01   7.91e+00s
5000   9.0191e+01   5.65e-04   4.60e-05   1.00e-01   8.15e+00s
5200   9.0194e+01   7.07e-04   4.27e-05   1.00e-01   8.40e+00s
5400   9.0194e+01   6.48e-04   3.45e-05   1.00e-01   8.64e+00s
5600   9.0199e+01   5.74e-04   4.36e-05   1.00e-01   8.88e+00s
5800   9.0202e+01   4.89e-04   3.47e-05   1.00e-01   9.12e+00s
6000   9.0206e+01   4.84e-04   4.36e-05   1.00e-01   9.38e+00s
6200   9.0205e+01   4.76e-04   3.54e-05   1.00e-01   9.62e+00s
6400   9.0204e+01   5.00e-04   4.92e-05   1.00e-01   9.86e+00s
6600   9.0205e+01   4.59e-04   2.72e-05   1.00e-01   1.01e+01s
6800   9.0206e+01   4.23e-04   2.77e-05   1.00e-01   1.04e+01s
6850   9.0206e+01   4.75e-04   1.95e-05   1.00e-01   1.04e+01s

status:               solved
solution polish:      unsuccessful
number of iterations: 6850
optimal objective:    90.2063
run time:             1.06e+01s
optimal rho estimate: 1.36e-01

...... Compressed sensing (regularization) is done.
       Min objective value=||fHat||= 90.2063 in L1-sense.
</pre></div></div>
</div>
<p>The convergence of the PCE terms:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">convPlot</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">kSet</span><span class="o">=</span><span class="n">kSet</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_78_0.png" src="../_images/examples_pce_78_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;UQit.pce.convPlot at 0x7f3c5c0a7110&gt;
</pre></div></div>
</div>
<p>Let’s evaluate the constructed PCE at the test samples</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">xiTest</span><span class="p">,</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="o">=</span><span class="n">testSamps2d</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">,</span><span class="n">qBound</span><span class="p">,</span><span class="n">nTest</span><span class="p">)</span>
<span class="n">pcePred_</span><span class="o">=</span><span class="n">pceEval</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xiTest</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">kSet</span><span class="o">=</span><span class="n">kSet</span><span class="p">)</span>
<span class="n">fPCE</span><span class="o">=</span><span class="n">pcePred_</span><span class="o">.</span><span class="n">pceVal</span>
</pre></div>
</div>
</div>
<p>We can compare the estimated mean and varaince of <span class="math notranslate nohighlight">\(f(q_1,q_2)\)</span> with what we get from the Monte-Carlo approach:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fEx_</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">distType</span><span class="p">,</span><span class="n">qInfo</span><span class="p">)</span>
<span class="n">fMean_mc</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">mean</span>
<span class="n">fVar_mc</span><span class="o">=</span><span class="n">fEx_</span><span class="o">.</span><span class="n">var</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------ MC -------- PCE --------- Error % &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean of f(q) = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fMean_mc</span><span class="p">,</span><span class="n">fMean</span><span class="p">,(</span><span class="n">fMean</span><span class="o">-</span><span class="n">fMean_mc</span><span class="p">)</span><span class="o">/</span><span class="n">fMean_mc</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Var  of f(q) = </span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="se">\t</span><span class="si">%g</span><span class="s1">&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">fVar_mc</span><span class="p">,</span><span class="n">fVar</span><span class="p">,(</span><span class="n">fVar</span><span class="o">-</span><span class="n">fVar_mc</span><span class="p">)</span><span class="o">/</span><span class="n">fVar_mc</span><span class="o">*</span><span class="mf">100.</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... Reference moments are calculated by the Monte-Carlo method with 100000 samples
------------ MC -------- PCE --------- Error %
Mean of f(q) = 0.360818 0.353707        -1.97089
Var  of f(q) = 3.60938  3.63038 0.581816
</pre></div></div>
</div>
<p>Finally, the response surface can be plotted.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plot2d</span><span class="p">(</span><span class="n">nTest</span><span class="p">,</span><span class="n">qTest</span><span class="p">,</span><span class="n">fTest</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">fPCE</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_84_0.png" src="../_images/examples_pce_84_0.png" />
</div>
</div>
</div>
<div class="section" id="Example-5:-gPCE-for-3-uniformly-distributed-parameters">
<h2>Example 5: gPCE for 3 uniformly distributed parameters<a class="headerlink" href="#Example-5:-gPCE-for-3-uniformly-distributed-parameters" title="Permalink to this headline">¶</a></h2>
<p>Consider the <a class="reference external" href="https://inis.iaea.org/search/search.aspx?orig_q=RN:21024954">Ishigami</a> function,</p>
<div class="math notranslate nohighlight">
\[\begin{equation}
f(\mathbf{q}) = \sin(q_1)+a\sin^2(q_2)+b\,q_3^4\sin(q_1) \,,
\end{equation}\]</div>
<p>in which <span class="math notranslate nohighlight">\(q_i\sim \mathcal{U}[\mathbb{Q}_i]\,,i=1,2,3\)</span>. The aim is to validate the estimated moments of <span class="math notranslate nohighlight">\(f(\mathbf{q})\)</span> by <code class="docutils literal notranslate"><span class="pre">UQit</span></code> with the analytical reference values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1">#Settings</span>
<span class="n">distType</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Unif&#39;</span><span class="p">,</span><span class="s1">&#39;Unif&#39;</span><span class="p">,</span><span class="s1">&#39;Unif&#39;</span><span class="p">]</span>   <span class="c1">#distribution type of the parameters</span>
<span class="n">qInfo</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">1.5</span><span class="p">],</span>               <span class="c1">#range of parameters</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">2.5</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">1.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">]]</span>
<span class="n">nQ</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>                        <span class="c1">#number of parameter samples in the 3 dimensions</span>
<span class="n">funOpt</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">}</span>            <span class="c1">#parameters in the Ishigami function</span>
<span class="c1">#PCE options</span>
<span class="n">truncMethod</span><span class="o">=</span><span class="s1">&#39;TO&#39;</span>  <span class="c1">#&#39;TP&#39;=Tensor Product</span>
                  <span class="c1">#&#39;TO&#39;=Total Order</span>
<span class="n">sampleType</span><span class="o">=</span><span class="s1">&#39;GQ&#39;</span>   <span class="c1">#&#39;GQ&#39;=Gauss Quadrature nodes</span>
                  <span class="c1">#other types: see trainSample in sampling.py</span>
<span class="n">pceSolveMethod</span><span class="o">=</span><span class="s1">&#39;Regression&#39;</span> <span class="c1">#&#39;Regression&#39;: for any combination of sample points and truncation methods</span>
                            <span class="c1">#&#39;Projection&#39;: only for &#39;GQ&#39;+&#39;TP&#39;</span>
<span class="n">nTest</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>   <span class="c1">#number of test samples for the parameters</span>
<span class="k">if</span> <span class="n">truncMethod</span><span class="o">==</span><span class="s1">&#39;TO&#39;</span><span class="p">:</span>
   <span class="n">LMax</span><span class="o">=</span><span class="mi">10</span>   <span class="c1">#max polynomial order in each parameter direction</span>
<span class="c1">#--------------------</span>
<span class="n">p</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">distType</span><span class="p">)</span>
<span class="c1">#Assemble the pceDict</span>
<span class="n">pceDict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">p</span><span class="p">,</span><span class="s1">&#39;truncMethod&#39;</span><span class="p">:</span><span class="n">truncMethod</span><span class="p">,</span><span class="s1">&#39;sampleType&#39;</span><span class="p">:</span><span class="n">sampleType</span><span class="p">,</span><span class="s1">&#39;pceSolveMethod&#39;</span><span class="p">:</span><span class="n">pceSolveMethod</span><span class="p">,</span>
         <span class="s1">&#39;distType&#39;</span><span class="p">:</span><span class="n">distType</span><span class="p">}</span>
<span class="k">if</span> <span class="n">truncMethod</span><span class="o">==</span><span class="s1">&#39;TO&#39;</span><span class="p">:</span>
   <span class="n">pceDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;LMax&#39;</span><span class="p">:</span><span class="n">LMax</span><span class="p">})</span>
<span class="c1">#Generate training data</span>
<span class="n">xi</span><span class="o">=</span><span class="p">[]</span>
<span class="n">q</span><span class="o">=</span><span class="p">[]</span>
<span class="n">qBound</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">samps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">trainSample</span><span class="p">(</span><span class="n">sampleType</span><span class="o">=</span><span class="n">sampleType</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nSamp</span><span class="o">=</span><span class="n">nQ</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">xi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samps</span><span class="o">.</span><span class="n">xi</span><span class="p">)</span>
    <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samps</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
    <span class="n">qBound</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">samps</span><span class="o">.</span><span class="n">qBound</span><span class="p">)</span>
<span class="n">fEx</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx3D</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;Ishigami&#39;</span><span class="p">,</span><span class="s1">&#39;tensorProd&#39;</span><span class="p">,</span><span class="n">funOpt</span><span class="p">)</span>
<span class="n">fVal</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">val</span>
<span class="c1">#Construct the PCE</span>
<span class="n">xiGrid</span><span class="o">=</span><span class="n">reshaper</span><span class="o">.</span><span class="n">vecs2grid</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
<span class="n">pce_</span><span class="o">=</span><span class="n">pce</span><span class="p">(</span><span class="n">fVal</span><span class="o">=</span><span class="n">fVal</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xiGrid</span><span class="p">,</span><span class="n">pceDict</span><span class="o">=</span><span class="n">pceDict</span><span class="p">,</span><span class="n">nQList</span><span class="o">=</span><span class="n">nQ</span><span class="p">)</span>
<span class="n">fMean</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fMean</span>
<span class="n">fVar</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">fVar</span>
<span class="n">pceCoefs</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">coefs</span>
<span class="n">kSet</span><span class="o">=</span><span class="n">pce_</span><span class="o">.</span><span class="n">kSet</span>
<span class="c1">#Convergence of the PCE terms</span>
<span class="n">convPlot</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">kSet</span><span class="o">=</span><span class="n">kSet</span><span class="p">)</span>
<span class="c1">#Exact moments of the Ishigami function</span>
<span class="n">fEx</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qBound</span><span class="p">)</span>
<span class="n">m</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">mean</span>
<span class="n">v</span><span class="o">=</span><span class="n">fEx</span><span class="o">.</span><span class="n">var</span>
<span class="c1">#Compare the moments estimated by PCE with the exact analytical values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">writeUQ</span><span class="o">.</span><span class="n">printRepeated</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t</span><span class="s1"> Exact </span><span class="se">\t\t</span><span class="s1"> PCE&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E[f]:  &#39;</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">fMean</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;V[f]:  &#39;</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">fVar</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">writeUQ</span><span class="o">.</span><span class="n">printRepeated</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="mi">50</span><span class="p">))</span>
<span class="c1">#Compare the PCE predictions at test points with the exact values of the model response</span>
<span class="n">qTest</span><span class="o">=</span><span class="p">[]</span>
<span class="n">xiTest</span><span class="o">=</span><span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
    <span class="n">testSamps</span><span class="o">=</span><span class="n">sampling</span><span class="o">.</span><span class="n">testSample</span><span class="p">(</span><span class="s1">&#39;unifSpaced&#39;</span><span class="p">,</span><span class="n">GQdistType</span><span class="o">=</span><span class="n">distType</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">qInfo</span><span class="o">=</span><span class="n">qInfo</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">qBound</span><span class="o">=</span><span class="n">qBound</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">nSamp</span><span class="o">=</span><span class="n">nTest</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">qTest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testSamps</span><span class="o">.</span><span class="n">q</span><span class="p">)</span>
    <span class="n">xiTest</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">testSamps</span><span class="o">.</span><span class="n">xi</span><span class="p">)</span>
<span class="n">fVal_test_ex</span><span class="o">=</span><span class="n">analyticTestFuncs</span><span class="o">.</span><span class="n">fEx3D</span><span class="p">(</span><span class="n">qTest</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">qTest</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">qTest</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;Ishigami&#39;</span><span class="p">,</span><span class="s1">&#39;tensorProd&#39;</span><span class="p">,</span><span class="n">funOpt</span><span class="p">)</span><span class="o">.</span><span class="n">val</span>
<span class="c1">#PCE prediction at test points</span>
<span class="n">pcePred_</span><span class="o">=</span><span class="n">pceEval</span><span class="p">(</span><span class="n">coefs</span><span class="o">=</span><span class="n">pceCoefs</span><span class="p">,</span><span class="n">xi</span><span class="o">=</span><span class="n">xiTest</span><span class="p">,</span><span class="n">distType</span><span class="o">=</span><span class="n">distType</span><span class="p">,</span><span class="n">kSet</span><span class="o">=</span><span class="n">kSet</span><span class="p">)</span>
<span class="n">fVal_test_pce</span><span class="o">=</span><span class="n">pcePred_</span><span class="o">.</span><span class="n">pceVal</span>
<span class="c1">#Plot the exact and PCE response values</span>
<span class="n">nTest_</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">nTest</span><span class="p">))</span>
<span class="n">fVal_test_pce_</span><span class="o">=</span><span class="n">fVal_test_pce</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">nTest_</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
<span class="n">err</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">fVal_test_pce_</span><span class="o">-</span><span class="n">fVal_test_ex</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fVal_test_pce_</span><span class="p">,</span><span class="s1">&#39;-ob&#39;</span><span class="p">,</span><span class="n">mfc</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fVal_test_ex</span><span class="p">,</span><span class="s1">&#39;-xr&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;PCE&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Index of test samples, k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Model response&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
... A gPCE for a 3-D parameter space is constructed.
...... PCE truncation method: TO
...... Method of computing PCE coefficients: Regression
         with LMax=10 as the max polynomial order in each direction.
...... Number of terms in PCE, K=  286
...... Number of Data point, n=  120
-----------------------------------------------------------------
           OSQP v0.6.0  -  Operator Splitting QP Solver
              (c) Bartolomeo Stellato,  Goran Banjac
        University of Oxford  -  Stanford University 2019
-----------------------------------------------------------------
problem:  variables n = 572, constraints m = 858
          nnz(P) + nnz(A) = 81786
settings: linear system solver = qdldl,
          eps_abs = 1.0e-05, eps_rel = 1.0e-05,
          eps_prim_inf = 1.0e-04, eps_dual_inf = 1.0e-04,
          rho = 1.00e-01 (adaptive),
          sigma = 1.00e-06, alpha = 1.60, max_iter = 100000
          check_termination: on (interval 25),
          scaling: on, scaled_termination: off
          warm start: on, polish: on, time_limit: off

iter   objective    pri res    dua res    rho        time
   1  -2.2880e+03   5.06e+02   2.16e+05   1.00e-01   3.13e-02s
 200   2.6270e+01   1.27e-02   1.50e-03   1.00e-01   8.94e-02s
 300   2.6288e+01   4.53e-03   1.82e-05   1.00e-01   1.20e-01s

status:               solved
solution polish:      unsuccessful
number of iterations: 300
optimal objective:    26.2884
run time:             1.45e-01s
optimal rho estimate: 2.32e-01

...... Compressed sensing (regularization) is done.
       Min objective value=||fHat||= 26.2884 in L1-sense.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_87_1.png" src="../_images/examples_pce_87_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
--------------------------------------------------
                 Exact           PCE
E[f]:   4.573160953235525 4.573189774327447
V[f]:   11.562474905206148 11.517012062432517
--------------------------------------------------
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_pce_87_3.png" src="../_images/examples_pce_87_3.png" />
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Saleh Rezaeiravesh

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>